<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gabriel Sosa ‚Äî CV</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ---- Reset / base ---- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; background:#f5f7fb; color:#111827; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; line-height: 1.45; }
    h1,h2,h3{ margin:0 0 .2rem 0; line-height:1.2 }
    p{ margin:.25rem 0 }
    ul{ margin:.35rem 0 .75rem 1rem }
    li{ margin:.2rem 0 }

    /* ---- Layout sized to A4 ---- */
    :root{
      --sheet-width: 210mm; /* A4 */
      --sheet-height: 297mm;
      --sheet-margin: 14mm; /* visual margin inside sheet */
      --accent: #0ea5e9; /* sky-500 */
      --muted: #475569; /* slate-600 */
    }

    .toolbar {
      position: sticky; top: 0; z-index: 50; background: #ffffffcc; backdrop-filter: blur(6px);
      display:flex; gap:.5rem; align-items:center; justify-content:center; padding:.6rem .8rem; border-bottom:1px solid #e5e7eb;
    }
    .toolbar button{
      appearance:none; border:1px solid #cbd5e1; background:white; border-radius:999px; padding:.55rem 1rem; font-weight:600; cursor:pointer;
      box-shadow: 0 1px 2px rgba(0,0,0,.05);
    }
    .toolbar button:hover{ border-color:#94a3b8 }

    .sheet {
      width: var(--sheet-width);
      min-height: auto; /* Permitir crecimiento natural */
      margin: 1.2rem auto; background:white; box-shadow: 0 10px 30px rgba(2,6,23,.08);
      position: relative; overflow: hidden; border-radius: 10px;
      padding: var(--sheet-margin);
    }

    /* Header */
    .header{ display:grid; grid-template-columns: 1fr 1fr; gap:10mm; align-items:center; border-bottom:2px solid #e5e7eb; padding-bottom:6mm; }
    .name{ font-size: 22px; font-weight: 800; letter-spacing: .2px; }
    .subtitle{ color:var(--muted); font-weight:600; font-size: 13px; }
    .contacts{ justify-self:end; text-align:right; font-size: 12.3px; color:#0f172a }
    .contacts a{ color:inherit; text-decoration:none; border-bottom: 1px dotted #94a3b8 }
    .contacts i{ color: #0ea5e9; margin-right: 4px; font-size: 11px; width: 12px; text-align: center; }

    .summary{ margin-top: 5mm; font-size: 13.6px; color:#0f172a; }

    /* Sections */
    .section{ margin-top: 9mm }
    .section-title{ font-size: 14.8px; text-transform: uppercase; letter-spacing: .12em; color:#0f172a; font-weight: 800; border-left: 4px solid var(--accent); padding-left: 8px; margin-bottom: 5mm }

    /* Experience cards */
    .role{ display:block; margin-bottom: 6mm; }
    .role h3{ font-size: 14.6px; margin-bottom: 1mm; }
    .role-header{ display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 1mm; }
    .role-title{ font-size: 14.6px; margin: 0; }
    .role-meta{ font-size: 12.2px; color: var(--muted); margin: 0; }
    .company{ font-weight:700; }
    .location{ color: var(--muted); margin-bottom: 2mm; font-size: 11px; }
    .bullets{ margin-top: 2mm; padding-left: 1rem; }
    .bullets li{ margin-bottom: 1.5mm; line-height: 1.4; font-size: 12px; }

    /* Typographic helpers */
    .muted{ color: var(--muted) }
    .tag{ display:inline-block; border:1px solid #cbd5e1; padding:.18rem .5rem; border-radius:999px; font-size:12px; margin:.15rem .15rem 0 0 }
    .tag i{ margin-right: 4px; }
    .tag.tech-tag{ background: #f8fafc; border-color: #e2e8f0; color: #475569; }
    .tech-tag i{ color: #0ea5e9; }
    
    /* Justificaci√≥n de texto para mejor presentaci√≥n */
    p, .bullets li, .location, .summary { 
      text-align: justify; 
      hyphens: auto; 
      -webkit-hyphens: auto; 
      -ms-hyphens: auto;
      word-spacing: -0.1em;
      letter-spacing: -0.01em;
      word-break: break-word;
      overflow-wrap: break-word;
    }

    /* Avoid breaks within role entries */
    .role { break-inside: avoid; page-break-inside: avoid; margin-bottom: 6mm; }
    .section { break-inside: avoid-column; }
    
    /* Force page break */
    .page-break { page-break-before: always; break-before: page; }

    /* Print styles */
    @media print {
      @page { 
        size: A4; 
        margin: 12mm 10mm 12mm 10mm; 
      }
      
      html, body { 
        height: auto !important; 
        background: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .sheet{ 
        margin: 0 !important; 
        box-shadow: none !important; 
        border-radius: 0 !important; 
        width: auto !important; 
        min-height: auto !important; 
        height: auto !important;
        max-width: none !important;
        padding: 0 !important;
        overflow: visible !important;
      }
      
      .toolbar{ display: none !important; }
      
      /* Mejorar saltos de p√°gina */
      .header { 
        break-after: auto;
        page-break-after: auto;
      }
      
      .summary {
        break-after: auto;
        page-break-after: auto;
      }
      
      .section { 
        break-inside: avoid;
        page-break-inside: avoid;
        margin-top: 6mm;
      }
      
      .section:first-of-type {
        margin-top: 4mm;
      }
      
      .role { 
        break-inside: avoid !important;
        page-break-inside: avoid !important;
        margin-bottom: 3mm;
      }
      
      .role:not(:last-child) {
        margin-bottom: 4mm;
      }
      
      .bullets {
        margin-top: 0.8mm;
        padding-left: 2.5mm;
      }
      
      .bullets li {
        margin-bottom: 0.8mm;
        line-height: 1.35;
        font-size: 9.5px;
        text-align: justify !important;
        hyphens: auto !important;
        -webkit-hyphens: auto !important;
        -ms-hyphens: auto !important;
        word-spacing: -0.05em !important;
        letter-spacing: -0.005em !important;
        word-break: break-word !important;
        overflow-wrap: break-word !important;
        -webkit-hyphenate-limit-before: 3;
        -webkit-hyphenate-limit-after: 2;
        hyphenate-limit-chars: 6 3 2;
      }
      
      /* Mantener justificaci√≥n en impresi√≥n */
      p, .location, .summary { 
        text-align: justify !important; 
        hyphens: auto !important; 
        -webkit-hyphens: auto !important; 
        -ms-hyphens: auto !important; 
        word-spacing: -0.08em !important;
        letter-spacing: -0.008em !important;
        word-break: break-word !important;
        overflow-wrap: break-word !important;
        -webkit-hyphenate-limit-before: 3;
        -webkit-hyphenate-limit-after: 2;
        hyphenate-limit-chars: 6 3 2;
      }
      
      /* Evitar que los t√≠tulos de secci√≥n queden solos al final de p√°gina */
      .section-title {
        break-after: avoid;
        page-break-after: avoid;
      }
      
      /* Asegurar que los enlaces se vean bien en impresi√≥n */
      a { 
        color: black !important; 
        text-decoration: none !important; 
      }
      
      /* Mantener iconos de contacto visibles en impresi√≥n */
      .contacts i { 
        color: #0ea5e9 !important; 
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
      
      /* Ajustar tama√±os de fuente para mejor legibilidad en impresi√≥n */
      .name { font-size: 20px; }
      .subtitle { font-size: 11.5px; }
      .section-title { font-size: 14px; }
      .role-title { font-size: 12px; }
      .role-meta { font-size: 10.5px; }
      .location { font-size: 9.5px; }
      .summary { font-size: 12px; }
      .tag { font-size: 9px; padding: 0.15rem 0.4rem; }
      .tag.tech-tag { font-size: 9px; }
    }

    /* Small screens preview */
    @media (max-width: 820px){
      .header{ grid-template-columns: 1fr; text-align:left }
      .contacts{ justify-self:start; text-align:left }
      .sheet{ margin:0; border-radius:0 }
    }
          @media print {
          .pdf-container * {
            hyphens: auto !important;
            -webkit-hyphens: auto !important;
            word-break: break-word !important;
            overflow-wrap: break-word !important;
            -webkit-hyphenate-limit-before: 3 !important;
            -webkit-hyphenate-limit-after: 2 !important;
            hyphenate-limit-chars: 6 3 2 !important;
            text-align: justify !important;
          }
          
          .pdf-container p, .pdf-container li, .pdf-container div {
            hyphens: auto !important;
            -webkit-hyphens: auto !important;
          }
        }
      </style>
</head>
<body>
  <div class="toolbar">
    <button onclick="window.print()" title="Print CV">üñ®Ô∏è Print</button>
    <button onclick="downloadPDF()" title="Download CV as PDF" id="download-btn">üìÑ Download PDF</button>
  </div>

  <main class="sheet" role="document">
    <!-- HEADER -->
    <header class="header">
      <div>
        <h1 class="name">Gabriel Alexander Sosa Ram√≠rez</h1>
        <div class="subtitle">Software Developer ¬∑ Full Stack</div>
      </div>
      <div class="contacts">
        <i class="fas fa-map-marker-alt" style="color: #0ea5e9; margin-right: 4px;"></i>Tegucigalpa, Honduras ¬∑  <i class="fab fa-linkedin" style="color: #0ea5e9; margin-right: 4px;"></i><a href="https://linkedin.com/in/gabrielsosar">GabrielSosaR</a><br />
       
        <i class="fas fa-phone" style="color: #0ea5e9; margin-right: 4px;"></i><a href="tel:+50495153072">+504 9515-3072</a> ¬∑ 
        <i class="fas fa-envelope" style="color: #0ea5e9; margin-right: 4px;"></i><a href="mailto:gabriel@gsosa.dev">gabriel@gsosa.dev</a>
      </div>
    </header>

    <!-- SUMMARY -->
    <section class="summary">
      <p>Cloud infrastructure specialist and full stack developer with experience in AWS, Azure, Kubernetes and modern web applications. I combine cloud expertise with end-to-end development to create complete solutions.</p>
    </section>

    <!-- EXPERIENCE -->
    <section class="section">
      <h2 class="section-title">Professional Experience</h2>
      <!-- Las experiencias se cargan din√°micamente desde JSON -->
      
      <!-- Fallback content mientras carga JavaScript -->
      <div id="experience-fallback">
        <article class="role">
          <div class="role-header">
            <h3 class="role-title"><span class="company">Stefanini Group S.A.</span> ‚Äî Senior Cloud Engineer & Full Stack Developer</h3>
            <div class="role-meta">2022 - Present</div>
          </div>
          <div class="location muted">Tegucigalpa, Honduras</div>
          <ul class="bullets">
            <li>Successfully migrated 25+ legacy applications to AWS with 99.9% uptime</li>
            <li>Developed 15+ full stack web applications with Java/Python/Angular/Node.js</li>
            <li>Reduced cloud costs by 40% through optimization and rightsizing</li>
            <li>Implemented CI/CD pipelines that reduced deployment time by 80%</li>
            <li>Designed multi-region architectures with automated disaster recovery</li>
          </ul>
          <div style="margin-top:3mm">
            <div style="font-weight:bold; font-size:12px; margin-bottom:2mm; color:#0f172a;">Technologies:</div>
            <span class="tag tech-tag"><i class="fab fa-aws"></i>AWS</span>
            <span class="tag tech-tag"><i class="fab fa-react"></i>React</span>
            <span class="tag tech-tag"><i class="fab fa-node-js"></i>Node.js</span>
            <span class="tag tech-tag"><i class="fas fa-layer-group"></i>Terraform</span>
            <span class="tag tech-tag"><i class="fas fa-cubes"></i>Kubernetes</span>
            <span class="tag tech-tag"><i class="fab fa-docker"></i>Docker</span>
            <span class="tag tech-tag"><i class="fas fa-database"></i>PostgreSQL</span>
            <span class="tag tech-tag"><i class="fab fa-python"></i>Python</span>
          </div>
        </article>

        <article class="role">
          <div class="role-header">
            <h3 class="role-title"><span class="company">Banco FICENSA</span> ‚Äî Senior Cloud Developer</h3>
            <div class="role-meta">2020 - 2022</div>
          </div>
          <div class="location muted">Tegucigalpa, Honduras</div>
          <ul class="bullets">
            <li>Developed and implemented cloud-ready modules for ATM systems processing 10,000+ daily transactions</li>
            <li>Designed and integrated software products that optimized internal processes reducing operational times by 45%</li>
            <li>Implemented automated ETLs and real-time log analysis for critical applications using cloud technologies</li>
            <li>Facilitated secure integrations with external providers improving banking connectivity and regulatory compliance</li>
            <li>Established CI/CD pipelines from scratch, reducing banking module deployment time from days to hours</li>
          </ul>
          <div style="margin-top:3mm">
            <div style="font-weight:bold; font-size:12px; margin-bottom:2mm; color:#0f172a;">Technologies:</div>
            <span class="tag tech-tag"><i class="fab fa-java"></i>Java 8</span>
            <span class="tag tech-tag"><i class="fab fa-angular"></i>Angular</span>
            <span class="tag tech-tag"><i class="fab fa-docker"></i>Docker</span>
            <span class="tag tech-tag"><i class="fas fa-cogs"></i>Jenkins</span>
            <span class="tag tech-tag"><i class="fas fa-database"></i>DB2</span>
            <span class="tag tech-tag"><i class="fas fa-code"></i>RPG ILE</span>
            <span class="tag tech-tag"><i class="fas fa-sync-alt"></i>CI/CD</span>
            <span class="tag tech-tag"><i class="fas fa-exchange-alt"></i>ETL</span>
            <span class="tag tech-tag"><i class="fas fa-aws"></i>AWS</span>
          </div>
        </article>

        <article class="role page-break">
          <div class="role-header">
            <h3 class="role-title"><span class="company">Banco Atl√°ntida</span> ‚Äî Backend Developer</h3>
            <div class="role-meta">2018 - 2020</div>
          </div>
          <div class="location muted">Tegucigalpa, Honduras</div>
          <ul class="bullets">
            <li>Executed complete banking core migration from IBS to SAP with zero service interruptions</li>
            <li>Developed containerized microservices architecture with Docker and orchestrated with Kubernetes on OpenShift</li>
            <li>Implemented critical Jteller application migration from RPG legacy to modern Java with Node.js backend</li>
            <li>Optimized enterprise banking operations through proactive monitoring and automated incident resolution</li>
            <li>Established containerization and orchestration standards that reduced deployment time by 70%</li>
          </ul>
          <div style="margin-top:3mm">
            <div style="font-weight:bold; font-size:12px; margin-bottom:2mm; color:#0f172a;">Technologies:</div>
            <span class="tag tech-tag"><i class="fab fa-java"></i>Java Spring Boot</span>
            <span class="tag tech-tag"><i class="fab fa-node-js"></i>Node.js</span>
            <span class="tag tech-tag"><i class="fab fa-docker"></i>Docker</span>
            <span class="tag tech-tag"><i class="fas fa-cubes"></i>Kubernetes</span>
            <span class="tag tech-tag"><i class="fas fa-server"></i>OpenShift</span>
            <span class="tag tech-tag"><i class="fas fa-database"></i>SAP HANA</span>
            <span class="tag tech-tag"><i class="fas fa-database"></i>DB2</span>
            <span class="tag tech-tag"><i class="fas fa-code"></i>RPG ILE</span>
            <span class="tag tech-tag"><i class="fas fa-project-diagram"></i>Microservices</span>
          </div>
        </article>
      </div>
    </section>

    <!-- EDUCATION -->
    <section class="section">
      <h2 class="section-title">Education / Certifications</h2>
      <article class="role" style="margin-bottom:4mm">
        <div class="role-header" style="margin-bottom: 0.2mm;">
          <h3 class="role-title">UNAH ‚Äî <span class="company">Systems Engineering</span></h3>
          <div class="role-meta muted">August 2017</div>
        </div>
        <div class="location muted" style="margin-top: 0; margin-bottom: 0; font-size: 11px;"><strong>Cum Laude: 83%</strong></div>
      </article>
      <article class="role" style="margin-bottom:4mm">
        <div class="role-header">
          <h3 class="role-title">CERTIPROF ‚Äî <span class="company">SFPC</span></h3>
          <div class="role-meta muted">June 2020</div>
        </div>
      </article>
      <article class="role">
        <div class="role-header">
          <h3 class="role-title">GOOGLE ‚Äî <span class="company">Digital Leader</span></h3>
          <div class="role-meta muted">June 2024</div>
        </div>
      </article>
    </section>

    <!-- SKILLS -->
    <section class="section">
      <h2 class="section-title">Additional Skills</h2>
      <!-- Las skills se cargan din√°micamente desde JSON como lista de bullets -->
      <div id="skills-content">
        <article class="role" style="margin-bottom:0">
          <ul class="bullets">
          </ul>
        </article>
      </div>
    </section>

  </main>

  <!-- jsPDF Library con fallbacks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" 
          onerror="this.onerror=null;this.src='https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js'"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
          onerror="this.onerror=null;this.src='https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js'"></script>
  
  <!-- Verificaci√≥n de librer√≠as -->
  <script>
    // Verificar y cargar librer√≠as PDF con retries
    let libraryRetries = 0;
    const maxRetries = 3;
    
    function checkLibraries() {
      const hasJsPDF = window.jspdf && window.jspdf.jsPDF;
      const hasHtml2Canvas = window.html2canvas;
      
      if (!hasJsPDF || !hasHtml2Canvas) {
        libraryRetries++;
        console.warn(`Intento ${libraryRetries}: Librer√≠as PDF no cargadas completamente`);
        
        if (libraryRetries < maxRetries) {
          setTimeout(checkLibraries, 1000);
        } else {
          console.error('No se pudieron cargar las librer√≠as PDF despu√©s de varios intentos');
          // Deshabilitar bot√≥n de descarga si las librer√≠as fallan
          const downloadBtn = document.getElementById('download-btn');
          if (downloadBtn) {
            downloadBtn.disabled = true;
            downloadBtn.textContent = '‚ùå PDF no disponible';
            downloadBtn.title = 'Las librer√≠as de PDF no se pudieron cargar';
          }
        }
        return false;
      }
      
      console.log('‚úÖ Librer√≠as PDF cargadas correctamente');
      return true;
    }
    
    // Verificar despu√©s de que el DOM est√© listo
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(checkLibraries, 500);
    });
  </script>
  
  <!-- i18n System -->
  <script src="./scripts/i18n-simple.js"></script>

  <script>
    // Detecci√≥n de navegador y capacidades
    const BrowserSupport = {
      isIE: navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') > -1,
      isEdge: navigator.userAgent.indexOf('Edge/') !== -1,
      isFirefox: navigator.userAgent.indexOf('Firefox') !== -1,
      isChrome: navigator.userAgent.indexOf('Chrome') !== -1,
      isSafari: navigator.userAgent.indexOf('Safari') !== -1 && navigator.userAgent.indexOf('Chrome') === -1,
      isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
      
      supportsDownload: function() {
        const a = document.createElement('a');
        return typeof a.download !== 'undefined';
      },
      
      supportsBlob: function() {
        try {
          return !!new Blob();
        } catch (e) {
          return false;
        }
      },
      
      supportsCanvas: function() {
        const canvas = document.createElement('canvas');
        return !!(canvas.getContext && canvas.getContext('2d'));
      }
    };
    
    // Log de compatibilidad para debugging
    console.log('üîç Detecci√≥n de navegador:', {
      userAgent: navigator.userAgent,
      isIE: BrowserSupport.isIE,
      isEdge: BrowserSupport.isEdge,
      isFirefox: BrowserSupport.isFirefox,
      isChrome: BrowserSupport.isChrome,
      isSafari: BrowserSupport.isSafari,
      isMobile: BrowserSupport.isMobile,
      supportsDownload: BrowserSupport.supportsDownload(),
      supportsBlob: BrowserSupport.supportsBlob(),
      supportsCanvas: BrowserSupport.supportsCanvas()
    });
    
    // Funci√≥n para mapear tecnolog√≠as a iconos
    const getTechIcon = (tech) => {
      const techIcons = {
        // Cloud Platforms
        'AWS': 'fab fa-aws',
        'Azure': 'fab fa-microsoft',
        'Google Cloud': 'fab fa-google',
        'GCP': 'fab fa-google',
        
        // Programming Languages
        'Java': 'fab fa-java',
        'Java 8': 'fab fa-java',
        'Java Spring Boot': 'fab fa-java',
        'Python': 'fab fa-python',
        'Node.js': 'fab fa-node-js',
        'JavaScript': 'fab fa-js-square',
        'TypeScript': 'fab fa-js-square',
        
        // Frontend
        'React': 'fab fa-react',
        'Angular': 'fab fa-angular',
        'Angular 17': 'fab fa-angular',
        'Vue': 'fab fa-vuejs',
        'HTML': 'fab fa-html5',
        'CSS': 'fab fa-css3-alt',
        
        // DevOps & Tools
        'Docker': 'fab fa-docker',
        'Kubernetes': 'fas fa-cubes',
        'Jenkins': 'fas fa-cogs',
        'Git': 'fab fa-git-alt',
        'GitHub': 'fab fa-github',
        'GitLab': 'fab fa-gitlab',
        'CI/CD': 'fas fa-sync-alt',
        
        // Databases
        'PostgreSQL': 'fas fa-database',
        'MySQL': 'fas fa-database',
        'MongoDB': 'fas fa-leaf',
        'DB2': 'fas fa-database',
        'SQL Server': 'fas fa-database',
        'SAP HANA': 'fas fa-database',
        
        // Infrastructure & Tools
        'Terraform': 'fas fa-layer-group',
        'CloudFormation': 'fas fa-layer-group',
        'OpenShift': 'fas fa-server',
        'Microservices': 'fas fa-project-diagram',
        'ETL': 'fas fa-exchange-alt',
        'Cloud Integration': 'fas fa-cloud',
        'RPG ILE': 'fas fa-code',
        
        // Monitoring & Analytics
        'Prometheus': 'fas fa-chart-line',
        'Grafana': 'fas fa-chart-bar',
        'ELK Stack': 'fas fa-search',
        'Elasticsearch': 'fas fa-search',
        
        // Default
        'default': 'fas fa-code'
      };
      
      return techIcons[tech] || techIcons['default'];
    };

    // Funci√≥n para obtener el idioma del localStorage o URL
    const getLanguage = () => {
      // Primero, verificar si viene de una URL con par√°metro de idioma
      const urlParams = new URLSearchParams(window.location.search);
      const langFromUrl = urlParams.get('lang');
      if (langFromUrl && (langFromUrl === 'es' || langFromUrl === 'en')) {
        return langFromUrl;
      }
      
      // Segundo, verificar localStorage (del portfolio principal)
      const savedLang = localStorage.getItem('portfolio-lang');
      if (savedLang && (savedLang === 'es' || savedLang === 'en')) {
        return savedLang;
      }
      
      // Por defecto, ingl√©s (en.json)
      return 'en';
    };

    // Funci√≥n para actualizar el contenido del CV
    const updateCV = async (lang) => {
      console.log('Actualizando CV con idioma:', lang);
      
      // Intentar cargar las traducciones manualmente si i18n no est√° disponible
      if (!window.I18n) {
        console.log('Sistema i18n no disponible, cargando manualmente...');
        try {
          const response = await fetch(`./lang/${lang}.json`);
          const translations = await response.json();
          
          await loadCVContent(translations.cv, translations.experience, lang);
          return;
        } catch (error) {
          console.error('Error cargando traducciones:', error);
          return;
        }
      }
      
      // Usar el sistema i18n existente si est√° disponible
      await window.I18n.changeLanguage(lang);
      const data = window.I18n.getCurrentTranslations().cv;
      const experienceData = window.I18n.getCurrentTranslations().experience;
      
      await loadCVContent(data, experienceData, lang);
    };

    // Funci√≥n auxiliar para cargar el contenido del CV
    const loadCVContent = async (data, experienceData, lang) => {
      if (!data) {
        console.error('No se encontraron datos del CV para el idioma:', lang);
        return;
      }
      
      console.log('Cargando contenido CV:', data);
      
      // Cargar datos del hero tambi√©n
      let heroData = null;
      try {
        if (!window.I18n) {
          const response = await fetch(`./lang/${lang}.json`);
          const translations = await response.json();
          heroData = translations.hero;
        } else {
          heroData = window.I18n.getCurrentTranslations().hero;
        }
      } catch (error) {
        console.error('Error cargando datos del hero:', error);
      }
      
      // Actualizar t√≠tulo de la p√°gina y idioma del documento
      document.title = data.title || 'Gabriel Sosa ‚Äî CV';
      document.documentElement.lang = lang;
      
      // Actualizar botones de la toolbar
      const printBtn = document.querySelector('.toolbar button[onclick="window.print()"]');
      const downloadBtn = document.getElementById('download-btn');
      if (printBtn && data.buttons) printBtn.innerHTML = data.buttons.print;
      if (downloadBtn && data.buttons) downloadBtn.innerHTML = data.buttons.download;
      
      // Actualizar header con datos del hero
      const subtitle = document.querySelector('.subtitle');
      if (subtitle && heroData && heroData.role) {
        subtitle.textContent = heroData.role;
      } else if (subtitle && data.subtitle) {
        subtitle.textContent = data.subtitle;
      }
      
      // Actualizar summary con hero.description
      const summaryP = document.querySelector('.summary p');
      if (summaryP && heroData && heroData.description) {
        summaryP.innerHTML = heroData.description;
      } else if (summaryP && data.summary) {
        summaryP.innerHTML = data.summary;
      }
        
      // Actualizar t√≠tulos de secci√≥n
      const sectionTitles = document.querySelectorAll('.section-title');
      if (data.sections) {
        if (sectionTitles[0]) sectionTitles[0].textContent = data.sections.experience;
        if (sectionTitles[1]) sectionTitles[1].textContent = data.sections.education;
        if (sectionTitles[2]) sectionTitles[2].textContent = data.sections.skills;
      }
      
      // Actualizar experiencias din√°micamente
      // Priorizar experience.jobs que tiene m√°s detalles
      if (experienceData && experienceData.jobs) {
        const experienceSection = document.querySelector('.section');
        
        // Ocultar fallback content
        const fallback = document.getElementById('experience-fallback');
        if (fallback) fallback.style.display = 'none';
        
        // Limpiar experiencias existentes (excepto el fallback)
        const roles = experienceSection.querySelectorAll('.role');
        roles.forEach(role => role.remove());
        
        // Generar nuevas experiencias desde experience.jobs
        experienceData.jobs.forEach((job, index) => {
          const article = document.createElement('article');
          article.className = 'role';
          if (index === 2) article.className += ' page-break';
          
          article.innerHTML = `
            <div class="role-header">
              <h3 class="role-title"><span class="company">${job.company}</span> ‚Äî ${job.title}</h3>
              <div class="role-meta">${job.period}</div>
            </div>
            <div class="location muted">${job.location}</div>
            <ul class="bullets">
              ${job.achievements.map(achievement => `<li>${achievement}</li>`).join('')}
            </ul>
            ${job.technologies && job.technologies.length > 0 ? 
              `<div style="margin-top:3mm">
                <div style="font-weight:bold; font-size:12px; margin-bottom:2mm; color:#0f172a;">${lang === 'es' ? 'Tecnolog√≠as:' : 'Technologies:'}</div>
                ${job.technologies.map(tech => `<span class="tag tech-tag"><i class="${getTechIcon(tech)}"></i>${tech}</span>`).join('')}
              </div>` : 
              ''}
          `;
          
          experienceSection.appendChild(article);
        });
      }
      // Fallback: usar cv.experiences si experience.jobs no est√° disponible
      else if (data.experiences) {
        const experienceSection = document.querySelector('.section');
        
        // Ocultar fallback content
        const fallback = document.getElementById('experience-fallback');
        if (fallback) fallback.style.display = 'none';
        
        // Limpiar experiencias existentes (excepto el fallback)
        const roles = experienceSection.querySelectorAll('.role');
        roles.forEach(role => role.remove());
        
        // Generar nuevas experiencias desde cv.experiences
        data.experiences.forEach((job, index) => {
          const article = document.createElement('article');
          article.className = 'role';
          if (index === 2) article.className += ' page-break';
          
          article.innerHTML = `
            <div class="role-header">
              <h3 class="role-title"><span class="company">${job.company}</span> ‚Äî ${job.title}</h3>
              <div class="role-meta">${job.period}</div>
            </div>
            <div class="location muted">${job.location}</div>
            <ul class="bullets">
              ${job.achievements.map(achievement => `<li>${achievement}</li>`).join('')}
            </ul>
          `;
          
          experienceSection.appendChild(article);
        });
      }
      
      // Actualizar educaci√≥n
      if (data.education) {
        const eduSection = document.querySelectorAll('.section')[1];
        const eduArticles = eduSection.querySelectorAll('article');
        data.education.forEach((edu, index) => {
          if (eduArticles[index]) {
            const article = eduArticles[index];
            const roleHeader = article.querySelector('.role-header');
            const roleTitle = roleHeader.querySelector('.role-title');
            const roleMeta = roleHeader.querySelector('.role-meta');
            
            roleTitle.innerHTML = `${edu.institution} ‚Äî <span class="company">${edu.degree}</span>`;
            roleMeta.textContent = edu.date;
            
            // Manejar honors si existen
            if (edu.honors) {
              let locationDiv = article.querySelector('.location');
              if (!locationDiv) {
                locationDiv = document.createElement('div');
                locationDiv.className = 'location muted';
                locationDiv.style.marginTop = '0';
                locationDiv.style.marginBottom = '0';
                locationDiv.style.fontSize = '11px';
                roleHeader.style.marginBottom = '0.2mm';
                roleHeader.insertAdjacentElement('afterend', locationDiv);
              }
              locationDiv.innerHTML = `<strong>${edu.honors}</strong>`;
            }
          }
        });
      }
      
      // Actualizar skills
      if (data.skills) {
        const skillsSection = document.querySelectorAll('.section')[2];
        const skillsList = skillsSection.querySelector('.bullets');
        skillsList.innerHTML = '';
        data.skills.forEach(skill => {
          const li = document.createElement('li');
          li.textContent = skill;
          skillsList.appendChild(li);
        });
      }
    };

    // Inicializar CV con el idioma correcto
    const initCV = async () => {
      console.log('Inicializando CV...');
      const lang = getLanguage();
      console.log('Idioma detectado:', lang);
      
      try {
  await updateCV(lang);
  // precargar hyphenators para mejor experiencia en PDF
  loadHyphenators().then(h => console.log('Hyphenators ready', Object.keys(h))).catch(e => console.warn('Hyphenators preload failed', e));
        console.log('CV actualizado correctamente');
      } catch (error) {
        console.error('Error inicializando CV:', error);
      }
      
      // Escuchar cambios en localStorage para sincronizar con el portfolio
      window.addEventListener('storage', async (e) => {
        if (e.key === 'portfolio-lang') {
          console.log('Cambio de idioma detectado:', e.newValue);
          try {
            await updateCV(e.newValue || 'en');
          } catch (error) {
            console.error('Error cambiando idioma:', error);
          }
        }
      });
    };
    const fitToViewport = () => {
      const sheet = document.querySelector('.sheet');
      if(!sheet) return;
      const vw = Math.min(window.innerWidth, document.documentElement.clientWidth);
      const desired = parseFloat(getComputedStyle(sheet).width);
      const pad = 24;
      const scale = Math.min(1, (vw - pad) / desired);
      sheet.style.transformOrigin = 'top center';
      sheet.style.transform = `scale(${scale})`;
    };

    // Cargar Hypher (hyphenation) din√°micamente y patrones para en/es si es posible
    const loadHyphenators = async () => {
      if (window.__hyphenators) return window.__hyphenators;
      window.__hyphenators = window.__hyphenators || {};
      try {
        // Cargar Hypher (constructor)
        if (!window.Hypher) {
          await new Promise((res, rej) => {
            const s = document.createElement('script');
            s.src = 'https://cdn.jsdelivr.net/npm/hypher@0.2.5/dist/hypher.min.js';
            s.onload = res; s.onerror = rej; document.head.appendChild(s);
          });
        }

        // Cargar patterns para english y spanish
        const patterns = {
          en: 'https://cdn.jsdelivr.net/npm/hyphenation.en-us@1.0.2/index.js',
          es: 'https://cdn.jsdelivr.net/npm/hyphenation.es@1.0.2/index.js'
        };

        for (const lang in patterns) {
          try {
            if (window.__hyphenators[lang]) continue;
            await new Promise((res, rej) => {
              const sp = document.createElement('script');
              sp.src = patterns[lang];
              sp.onload = () => {
                try {
                  // Algunos paquetes exponen `Hyphenation` o `patterns`
                  const pattern = window[Object.keys(window).find(k => k.toLowerCase().includes('hyphen') && window[k] && window[k].patterns && window[k].patterns[lang])];
                } catch (e){}
                res();
              };
              sp.onerror = rej;
              document.head.appendChild(sp);
            });

            // Intenta extraer patterns desde variables globales comunes
            const patKey = Object.keys(window).find(k => /hyphen|hypher|patterns/i.test(k));
            const patObj = patKey ? window[patKey] : null;
            if (patObj && patObj[lang]) {
              window.__hyphenators[lang] = new Hypher(patObj[lang]);
            }
          } catch (e) {
            // ignore pattern load errors
          }
        }
      } catch (e) {
        // loading failed, leave hyphenators empty - fallback will be used
        console.warn('Hyphenators failed to load:', e);
      }
      return window.__hyphenators;
    };

    // Helper: insertar guiones suaves (soft hyphens) en texto dentro de un contenedor
  const addSoftHyphensToContainer = (container, hyphenMap = {}, options = { fallback: true }) => {
      if (!container) return;
      const skipTags = new Set(['A', 'CODE', 'PRE', 'SCRIPT', 'STYLE', 'IMG', 'SVG']);
      const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null, false);
      let node;

      const matchCase = (orig, repl) => {
        if (!orig) return repl;
        if (orig.toUpperCase() === orig) return repl.toUpperCase();
        if (orig[0] && orig[0].toUpperCase() === orig[0]) return repl[0].toUpperCase() + repl.slice(1);
        return repl;
      };

  while ((node = walker.nextNode())) {
        if (!node.nodeValue || !node.nodeValue.trim()) continue;
        const parent = node.parentElement;
        if (parent && skipTags.has(parent.tagName)) continue;

        let text = node.nodeValue;

        // Aplicar mapeo expl√≠cito (palabras a romper en puntos concretos)
        for (const key in hyphenMap) {
          try {
            const repl = hyphenMap[key];
            const re = new RegExp(key, 'gi');
            text = text.replace(re, (m) => matchCase(m, repl));
          } catch (e) {
            // Si la clave no es un regex v√°lido, saltarla
            continue;
          }
        }

        // Si hay hyphenators globales cargados (Hypher), √∫salos para hyphenation precisa
        try {
          const hyphens = window.__hyphenators || null;
          const lang = (container && container.lang) || document.documentElement.lang || 'en';
          const chosen = hyphens && (hyphens[lang] || hyphens[lang.replace('-', '_')] || hyphens[lang.split('-')[0]]);
          if (chosen) {
            // aplicar hyphenation palabra por palabra
            text = text.replace(/\S+/g, (word) => {
              // evitar emails, urls y tokens con guiones/puntos
              if (/https?:\/\//i.test(word) || /\w+@\w+\./.test(word) || /[\.\/\-]/.test(word)) return word;
              // solo hyphenate palabras largas
              if (word.length < (options.minLength || 6)) return word;
              try {
                const parts = chosen.hyphenate ? chosen.hyphenate(word) : (chosen.hypher ? chosen.hypher.hyphenate(word) : null);
                if (Array.isArray(parts) && parts.length > 1) return parts.join('\u00AD');
              } catch (e) {
                return word;
              }
              return word;
            });
          } else if (options.fallback) {
            // Fallback: insertar soft hyphen en palabras largas (evitar emails, urls y tokens con guiones/puntos)
            if (!/https?:\/\//i.test(text) && !/\w+@\w+\./.test(text)) {
              text = text.replace(/([A-Za-z√Ä-√ñ√ò-√∂√∏-√ø0-9]{10,})/g, (m) => {
                if (/[\.\/\-]/.test(m)) return m;
                return m.replace(/(.{6})/g, '$1\u00AD');
              });
            }
          }
        } catch (e) {
          // Si cualquier fallo, usar fallback
          if (options.fallback) {
            if (!/https?:\/\//i.test(text) && !/\w+@\w+\./.test(text)) {
              text = text.replace(/([A-Za-z√Ä-√ñ√ò-√∂√∏-√ø0-9]{10,})/g, (m) => {
                if (/[\.\/\-]/.test(m)) return m;
                return m.replace(/(.{6})/g, '$1\u00AD');
              });
            }
          }
        }

        if (text !== node.nodeValue) node.nodeValue = text;
      }
    };
    
    // Funci√≥n para mostrar notificaciones
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      const bgColor = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6';
      
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: ${bgColor};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 500;
        z-index: 10000;
        max-width: 90%;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        animation: slideInDown 0.3s ease-out;
      `;
      notification.textContent = message;
      
      // Agregar animaci√≥n CSS
      if (!document.getElementById('notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
          @keyframes slideInDown {
            from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
          }
        `;
        document.head.appendChild(style);
      }
      
      document.body.appendChild(notification);
      
      // Remover notificaci√≥n despu√©s de 5 segundos
      setTimeout(() => {
        if (notification.parentNode) {
          document.body.removeChild(notification);
        }
      }, 5000);
    }

    // Funci√≥n para descargar PDF mejorada para compatibilidad entre navegadores
    const downloadPDF = async () => {
      const downloadBtn = document.getElementById('download-btn');
      const originalText = downloadBtn.textContent;
      
      // Verificar compatibilidad del navegador
      if (!BrowserSupport.supportsCanvas()) {
        showNotification('‚ùå Tu navegador no soporta la generaci√≥n de PDFs. Por favor actual√≠zalo.', 'error');
        return;
      }
      
      if (!BrowserSupport.supportsBlob() && !BrowserSupport.supportsDownload()) {
        showNotification('‚ùå Tu navegador no soporta descargas de archivos. Por favor actual√≠zalo.', 'error');
        return;
      }
      
      try {
        // Verificar que las librer√≠as est√©n cargadas
        if (!window.jspdf || !window.html2canvas) {
          throw new Error('PDF libraries not loaded');
        }
        
        // Cambiar texto del bot√≥n mientras se genera
        downloadBtn.textContent = '‚è≥ Generando PDF...';
        downloadBtn.disabled = true;
        
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('portrait', 'mm', 'a4');
        
        // Obtener elementos principales
        const sheet = document.querySelector('.sheet');
        const toolbar = document.querySelector('.toolbar');
        
        // Ocultar toolbar temporalmente para el PDF
        const originalToolbarDisplay = toolbar.style.display;
        toolbar.style.display = 'none';
        
        // Remover escala temporal para captura
        const originalTransform = sheet.style.transform;
        sheet.style.transform = 'none';
        
        // Crear contenedor temporal para la primera p√°gina (hasta Banco FICENSA)
        const tempContainer1 = document.createElement('div');
  tempContainer1.className = 'pdf-container';
  // asignar idioma para que el motor de hyphenation use reglas correctas (es/en)
  try { tempContainer1.lang = (typeof getLanguage === 'function' ? getLanguage() : document.documentElement.lang) || 'es'; } catch(e){}
        tempContainer1.style.cssText = `
          width: ${sheet.offsetWidth}px;
          padding: ${getComputedStyle(sheet).padding};
          background: white;
          font-family: ${getComputedStyle(sheet).fontFamily};
          font-size: ${getComputedStyle(sheet).fontSize};
          line-height: ${getComputedStyle(sheet).lineHeight};
          color: ${getComputedStyle(sheet).color};
          hyphens: auto !important;
          -webkit-hyphens: auto !important;
          word-break: normal !important;
          overflow-wrap: break-word !important;
          white-space: normal !important;
          -webkit-hyphenate-character: "\u00AD" !important;
          hyphenate-character: "\u00AD" !important;
          -webkit-hyphenate-limit-before: 3 !important;
          -webkit-hyphenate-limit-after: 2 !important;
          hyphenate-limit-chars: 6 3 2 !important;
          text-align: justify !important;
        `;
        
        // Clonar header, summary y las primeras dos experiencias
        const header = sheet.querySelector('.header').cloneNode(true);
        const summary = sheet.querySelector('.summary').cloneNode(true);
        const experienceSection = sheet.querySelector('.section').cloneNode(false);
        const sectionTitle = sheet.querySelector('.section-title').cloneNode(true);
        const stefanini = sheet.querySelectorAll('.role')[0].cloneNode(true);
        const ficensa = sheet.querySelectorAll('.role')[1].cloneNode(true);
        
        experienceSection.appendChild(sectionTitle);
        experienceSection.appendChild(stefanini);
        experienceSection.appendChild(ficensa);
        
        tempContainer1.appendChild(header);
        tempContainer1.appendChild(summary);
        tempContainer1.appendChild(experienceSection);
        
        document.body.appendChild(tempContainer1);
        // Aplicar guiones suaves espec√≠ficos antes de capturar para controlar saltos
        addSoftHyphensToContainer(tempContainer1, {
          // Use visible hyphen + zero-width space so jsPDF/html2canvas preserve the hyphen
          'optimization': 'optimi-\u200Bzation',
          'optimisation': 'optimi-\u200Bsation',
          'capabilities': 'capabili-\u200Bties',
          'capability': 'capabi-\u200Blity',
          'lift-and-shift': 'lift-and-\u200Bshift'
        });
        
        // Capturar primera p√°gina con configuraci√≥n mejorada para compatibilidad
        const canvas1 = await html2canvas(tempContainer1, {
          scale: window.devicePixelRatio || 2, // Usar DPR del dispositivo o fallback a 2
          useCORS: true,
          allowTaint: false, // Prevenir problemas con CORS
          logging: false,
          backgroundColor: '#ffffff',
          removeContainer: false, // No remover autom√°ticamente
          imageTimeout: 15000, // Timeout para im√°genes
          onclone: function(clonedDoc) {
            // Asegurar que el documento clonado tenga los estilos correctos
            const clonedStyle = clonedDoc.createElement('style');
            clonedStyle.textContent = `
              * { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, sans-serif !important; }
              .pdf-container { hyphens: auto !important; word-break: normal !important; }
            `;
            clonedDoc.head.appendChild(clonedStyle);
          }
        });
        
        const imgData1 = canvas1.toDataURL('image/png');
        const imgWidth = 210; // A4 width in mm
        const imgHeight1 = (canvas1.height * imgWidth) / canvas1.width;
        
        pdf.addImage(imgData1, 'PNG', 0, 0, imgWidth, imgHeight1);
        
        // Crear contenedor temporal para la segunda p√°gina (desde Banco Atl√°ntida)
        const tempContainer2 = document.createElement('div');
  tempContainer2.className = 'pdf-container';
  try { tempContainer2.lang = (typeof getLanguage === 'function' ? getLanguage() : document.documentElement.lang) || 'es'; } catch(e){}
  tempContainer2.style.cssText = tempContainer1.style.cssText;
        
        // Clonar el resto del contenido - EMPEZANDO con Banco Atl√°ntida
        const experienceSection2 = sheet.querySelector('.section').cloneNode(false);
        const sectionTitle2 = sheet.querySelector('.section-title').cloneNode(true);
        const atlantida = sheet.querySelectorAll('.role')[2].cloneNode(true);
        
        experienceSection2.appendChild(sectionTitle2);
        experienceSection2.appendChild(atlantida);
        
        // PRIMERO agregar la experiencia con Atl√°ntida
        tempContainer2.appendChild(experienceSection2);
        
        // DESPU√âS agregar otras secciones (educaci√≥n, skills)
        const otherSections = Array.from(sheet.querySelectorAll('.section')).slice(1);
        otherSections.forEach(section => {
          tempContainer2.appendChild(section.cloneNode(true));
        });
        
        document.body.appendChild(tempContainer2);
        // Aplicar guiones suaves al segundo contenedor tambi√©n
        addSoftHyphensToContainer(tempContainer2, {
          'optimization': 'optimi-\u200Bzation',
          'optimisation': 'optimi-\u200Bsation',
          'capabilities': 'capabili-\u200Bties',
          'capability': 'capabi-\u200Blity',
          'lift-and-shift': 'lift-and-\u200Bshift'
        });
        
        // Capturar segunda p√°gina con la misma configuraci√≥n mejorada
        const canvas2 = await html2canvas(tempContainer2, {
          scale: window.devicePixelRatio || 2,
          useCORS: true,
          allowTaint: false,
          logging: false,
          backgroundColor: '#ffffff',
          removeContainer: false,
          imageTimeout: 15000,
          onclone: function(clonedDoc) {
            const clonedStyle = clonedDoc.createElement('style');
            clonedStyle.textContent = `
              * { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, sans-serif !important; }
              .pdf-container { hyphens: auto !important; word-break: normal !important; }
            `;
            clonedDoc.head.appendChild(clonedStyle);
          }
        });
        
        const imgData2 = canvas2.toDataURL('image/png');
        const imgHeight2 = (canvas2.height * imgWidth) / canvas2.width;
        
        pdf.addPage();
        pdf.addImage(imgData2, 'PNG', 0, 0, imgWidth, imgHeight2);
        
        // Limpiar contenedores temporales
        if (tempContainer1 && tempContainer1.parentNode) {
          document.body.removeChild(tempContainer1);
        }
        if (tempContainer2 && tempContainer2.parentNode) {
          document.body.removeChild(tempContainer2);
        }
        
        // Restaurar estilos
        toolbar.style.display = originalToolbarDisplay;
        sheet.style.transform = originalTransform;
        
        // Descargar el PDF con mejor compatibilidad
        const fileName = 'Gabriel_Sosa_CV.pdf';
        
        // M√©todo mejorado para descarga compatible con todos los navegadores
        try {
          // M√©todo moderno (Chrome, Firefox, Edge)
          pdf.save(fileName);
          showNotification('‚úÖ CV descargado exitosamente', 'success');
        } catch (saveError) {
          console.warn('M√©todo save() fall√≥, usando m√©todo alternativo:', saveError);
          // M√©todo alternativo para navegadores m√°s antiguos
          const pdfOutput = pdf.output('blob');
          
          if (navigator.msSaveBlob) {
            // Internet Explorer / Edge Legacy
            navigator.msSaveBlob(pdfOutput, fileName);
            showNotification('‚úÖ CV descargado exitosamente', 'success');
          } else if (BrowserSupport.supportsBlob() && BrowserSupport.supportsDownload()) {
            // Fallback universal
            const url = window.URL.createObjectURL(pdfOutput);
            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = fileName;
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            showNotification('‚úÖ CV descargado exitosamente', 'success');
            
            // Limpiar el objeto URL despu√©s de un breve delay
            setTimeout(() => {
              window.URL.revokeObjectURL(url);
            }, 1000);
          } else {
            // Si nada funciona, al menos mostrar el PDF en nueva ventana
            const pdfDataUri = pdf.output('dataurlstring');
            window.open(pdfDataUri, '_blank');
            showNotification('üí° PDF abierto en nueva ventana. Usa Ctrl+S para guardarlo.', 'info');
          }
        }
        
      } catch (error) {
        console.error('Error generando PDF:', error);
        
        // Mostrar mensaje de error m√°s espec√≠fico
        let errorMessage = 'Error al generar el PDF. ';
        
        if (error.message.includes('PDF libraries not loaded')) {
          errorMessage += 'Las librer√≠as de PDF no se cargaron correctamente. Por favor recarga la p√°gina.';
        } else if (error.name === 'NetworkError') {
          errorMessage += 'Error de conectividad. Verifica tu conexi√≥n a internet.';
        } else if (error.message.includes('html2canvas')) {
          errorMessage += 'Error al capturar el contenido. Intenta de nuevo.';
        } else if (BrowserSupport.isIE || BrowserSupport.isEdge) {
          errorMessage += 'Tu navegador tiene compatibilidad limitada. Intenta con Chrome o Firefox.';
        } else if (BrowserSupport.isSafari) {
          errorMessage += 'Safari puede tener problemas. Intenta permitir descargas o usa Chrome.';
        } else {
          errorMessage += 'Por favor intenta de nuevo o usa un navegador actualizado.';
        }
        
        // Usar el nuevo sistema de notificaciones
        showNotification(errorMessage, 'error');
        
        // Tambi√©n limpiar contenedores en caso de error
        const containers = [
          document.querySelector('[style*="pdf-container"]'),
          ...document.querySelectorAll('.pdf-container')
        ];
        containers.forEach(container => {
          if (container && container.parentNode) {
            container.parentNode.removeChild(container);
          }
        });
      } finally {
        // Restaurar bot√≥n
        downloadBtn.textContent = originalText;
        downloadBtn.disabled = false;
      }
    };

    window.addEventListener('load', async () => {
      console.log('P√°gina cargada, inicializando CV...');
      // Esperar un poco para que todos los scripts se carguen
      setTimeout(async () => {
        await initCV();
        fitToViewport();
      }, 500);
    });
    window.addEventListener('resize', fitToViewport);
  </script>
</body>
</html>
